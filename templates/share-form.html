{% extends "base.html" %}
{% block content %}

<div class="container">
    <div class="row col-md-3"></div>
    <div class="row col-md-7" style="font-size:1.5em">
        {{ form.slug }}
        <input class="btn-primary btn btn-sm" type="button" value="{%trans%}Return to form{%endtrans%}" onClick="location.href='/forms/view/{{ form._id }}'">
        <hr />
    </div>
    <div class="row col-md-2"></div>
</div>

<div class="container">
    <div class="row col-md-3"></div>
    <div class="row col-md-9">

        <div style="font-size:1.5em;">
            {%trans%}Share results{%endtrans%}
        </div>
        {%trans%}Share a readonly link with interested parties{%endtrans%}
        <div style="padding-top:0.7em">
            <span id="toggle_sharedEntries" class="btn-group btn-toggle">
                <button id="sharedEntries_true" class="btn btn-xs btn-default {% if form.areEntriesShared() %}active btn-success{% endif %}">{%trans%}Enabled{%endtrans%}</button>
                <button id="sharedEntries_false" class="btn btn-xs btn-default {% if not form.areEntriesShared() %}active btn-success{% endif %}">{%trans%}Disabled{%endtrans%}</button>
            </span>
            <a id="enabled_link" href="{{ form.getSharedEntriesURL() }}" {%if not form.areEntriesShared()%}style="display:None"{%endif%}>{{ form.getSharedEntriesURL() }}</a>
            <span id="disabled_link" style="text-decoration:line-through; {%if form.areEntriesShared()%}display:None{%endif%}" >{{ form.getSharedEntriesURL() }}</span>
        </div>
    </div>
</div>

<div class="container" style="padding-top:1em;">
    <div class="row col-md-3"></div>
    <div class="row col-md-5">

        <div style="padding-top:1.2em; font-size:1.5em;">
            {%trans%}Editors{%endtrans%}
        </div>
        <div>
            {%trans%}Users listed here have the same permissions as you{%endtrans%}
        </div>

        <p style="padding-top:1.2em;"></p>
        
        <table class="table table-condensed">
        {% for editor in form.editors %}
        <tr id="editor_{{editor._id}}">
            <td>
                {{ editor.email }}
            </td>
            <td class="text-right">
            <input class="btn-success btn btn-xs btn-danger" type="button" value="{%trans%}Remove{%endtrans%}" onClick="js:removeEditor('{{editor._id}}');">
            </td>
        </tr>
        {% endfor %}
        <tr>
        <form action="/forms/add-editor/{{form._id}}" method="POST">
        <td>
            <input name="email" type="text" placeholder="New editor's email" class="form-control" required >
        </td>
        <td class="text-right">
            <input class="btn-primary btn btn-md" type="submit" value="{%trans%}Add{%endtrans%}" >
        </td>
        </form>
        </tr>
        </table>

    </div>
    <div class="row col-md-4"></div>
</div>


<script>
function removeEditor(editor_id){
    $.ajax({
        url : "/forms/remove-editor/{{form._id}}/"+editor_id,
        type: "POST",
        dataType: "json",
        success: function(data, textStatus, jqXHR)
        {
            if (data == editor_id) {
                $('#editor_'+editor_id).hide();
            }
        }
    });
}
document.getElementById('toggle_sharedEntries').addEventListener('click', function(evt){
    $.ajax({
        url : "/form/toggle-shared-entries/{{ form._id }}",
        type: "POST",
        dataType: "json",
        success: function(data, textStatus, jqXHR)
        {
            if (data.enabled == true) {
                $('#sharedEntries_true').addClass('active  btn-success');
                $('#sharedEntries_false').removeClass('active btn-success');
                $('#enabled_link').show()
                $('#disabled_link').hide()
            }
            else if (data.enabled == false) {
                $('#sharedEntries_true').removeClass('active btn-success');
                $('#sharedEntries_false').addClass('active btn-success');
                $('#enabled_link').hide()
                $('#disabled_link').show()
            }
        }
    });
});
</script>
  
{% endblock %}
