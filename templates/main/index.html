{% extends "base.html" %}
{% block content %}



{% if g.isAdmin %}
<script src="/static/simplemde/simplemde.min.js"></script>
<link rel="stylesheet" type="text/css" href="/static/simplemde/simplemde.min.css">
<link rel="stylesheet" type="text/css" href="/static/css/font-awesome.min.css">
{% endif %}


<div class="container">
<div class="row col-md-8">

    <div id="blurb">
        {{ site.blurb['html']|safe }}
        {% if g.isAdmin %}
        <p></p>
        <hr />
        <input id="show-editor" class="btn-success btn" type="button" value="{%trans%}Edit text{%endtrans%}" />
        {% endif %}        
    </div>

    {% if g.isAdmin %}
    <div id="editor" style="display:none">
        <input id="save-edit" class="btn-success btn" type="button" value="{%trans%}Save{%endtrans%}" />
        <input id="cancel-edit" class="btn-primary btn" type="button" value="{%trans%}Cancel{%endtrans%}" />
        <p></p>
        <form id="editor-form" action="/site/save-blurb" method="post">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            <textarea id="sm-editor" name="editor">{{ site.blurb['markdown'] }}</textarea>
        </form>
    </div>
    {% endif %}

</div>
<div class="row col-md-1"></div>
<div class="row col-md-3">
    
    <form action="/user/login" method="POST" style="margin-top:1.5em">
        {{ wtform.csrf_token }}
        <p>
            {{ wtform.username.label }}<br />
            {{ wtform.username(class_="form-control") }}
        </p>    
        <p>
            {{ wtform.password.label }}<br />
            {{ wtform.password(class_="form-control") }}
        </p>
        <input class="btn-success btn" type="submit" value="{%trans%}Login{%endtrans%}" {% if g.current_user %}disabled{%endif%} />
    </form>

    <br />
    {% if g.current_user %}
        <a href="/user/reset-password">{%trans%}Forgot your password?{%endtrans%}</a>
    {% else %}
        <a href="/site/recover-password">{%trans%}Forgot your password?{%endtrans%}</a>
    {% endif %}
    
    {% if not site.invitationOnly %}
        <br />
        <a href="/user/new">{%trans%}Publish your own form{%endtrans%}</a>
    {% endif %}
</div>
</div>

{% if g.isAdmin %}
<script>
$(document).ready(function() {

    var simplemde = new SimpleMDE({ 
                                autosave: {enabled: false},
                                autofocus: true,
                                spellChecker: false,
                                autoDownloadFontAwesome: false,
                                element: $("#sm-editor")[0]
                             });

    $("#show-editor").click(function(){
        $('#blurb').hide();
        $('#editor').show();
        $('.flash_message').hide();
        simplemde.value($("#sm-editor").val())
        window.scrollTo(0,0);
    });
    $("#save-edit").click(function(){
        $('#editor').hide();
        simplemde.toTextArea();
        $("#editor-form").submit();
    });
    $("#cancel-edit").click(function(){
        $('#editor').hide();
        $('#blurb').show();
    });
});
</script>
{% endif %}

{% endblock %}
